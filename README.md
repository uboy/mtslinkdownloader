# mtslinkdownloader
`mtslinkdownloader` - это инструмент для загрузки и обработки записей вебинаров, предоставляемых сервисом MTS Link. Он автоматически загружает видео и аудиофайлы вебинаров, синхронизирует их и создает единый видеоролик.

## Установка
### poetry:
```bash
poetry add git+https://github.com/motattack/mtslinkdownloader.git
```

### pip:
```bash
pip install git+https://github.com/motattack/mtslinkdownloader.git
```

## Использование
Для использования `mtslinkdownloader`, вы можете использовать командную строку или графический интерфейс.

### Графический режим (GUI)
Для запуска приложения с графическим интерфейсом выполните:
```bash
python -m mtslinkdownloader.gui
```
В графическом режиме вы можете удобно вставить ссылку, настроить параметры и следить за прогрессом.
Логи теперь дополнительно показывают время старта/завершения и накопленное время выполнения (elapsed) для всего процесса и этапа рендера.

### Правила компоновки видео
- Камера лектора (администратора вебинара) закрепляется в верхнем слоте правой панели и не вытесняется камерами других участников.
- Нижний слот правой панели всегда выделен под чат/Q&A: показываются последние сообщения, список обновляется по мере появления новых сообщений.
- Сообщения в чате показываются с таймстампом в формате `[CHAT HH:MM:SS]` / `[Q&A HH:MM:SS]` и переносятся по ширине блока.
- Блок чата отрисовывается шире карточек камер для лучшей читаемости текста.
- Аудио участников больше не зависит от скрытия «молчащих» камер: звук не должен пропадать из-за VAD-фильтра.
- Парсинг чата поддерживает как `chat.*`, так и события с `type=chat` (если текст находится во вложенных полях).
- Параметры `start offset` и `max duration` строго ограничивают окно рендера (видео не должно выходить за заданный диапазон).

### Командная строка (CLI)
Просто вызовите в терминале `mtslinkdownloader` с URL записи вебинара в качестве аргумента.

Вот несколько примеров использования:
### Пример 1. Загрузка обычной записи:
```bash
mtslinkdownloader https://my.mts-link.ru/12345678/987654321/record-new/123456789/record-file/1234567890
```

### Пример 2. Загрузка быстрой встречи:
```bash
mtslinkdownloader https://my.mts-link.ru/12345678/987654321/record-new/123456789
```

### Пример 3. Загрузка приватной записи:
```bash
mtslinkdownloader https://my.mts-link.ru/12345678/987654321/record-new/123456789/record-file/1234567890 --session-id a1b2c3d4
```

> **Примечание**: Узнать свой `sessionId` можно в кукисах сайта (нужно быть авторизованным). [Пример](https://raw.githubusercontent.com/motattack/mtslinkdownloader/refs/heads/master/get_sessionId.mp4) как это можно сделать.

## Сборка и дистрибуция
Проект поддерживает автоматическую сборку в исполняемые файлы (`.exe` для Windows, бинарные файлы для Linux и macOS) и упаковку в ZIP-архивы для релизов.

### Запуск сборки
Для создания готового пакета под текущую платформу выполните:
```bash
python build_binary.py
```
Скрипт создаст готовый ZIP-архив в директории `dist/`, например `mtslinkdownloader-windows.zip`.

Внутри архива вы найдете:
- `mtslinkdownloader.exe` — графический интерфейс.
- `mtslinkdownloader-cli.exe` — консольная версия для работы через терминал.

> **Совет для Windows 11**: Если Smart App Control блокирует запуск, нажмите правой кнопкой на скачанный ZIP-архив -> Свойства -> установите галочку **"Разблокировать" (Unblock)** -> OK. После этого распакуйте архив.

## Использование в проекте

Если вы хотите интегрировать `mtslinkdownloader` в свой проект, вы можете использовать функцию `fetch_webinar_data` для загрузки данных вебинара.

Например, для ссылки: https://my.mts-link.ru/12345678/987654321/record-new/123456789/record-file/1234567890, формат будет следующим:
```
https://my.mts-link.ru/{organization_id}/{room_id}/record-new/{event_sessions}/record-file/{record_id}
```

```python
from mtslinkdownloader.webinar import fetch_webinar_data

fetch_webinar_data(
  event_sessions='123456789',
  record_id='1234567890',   # Нужен для обычной встречи, не нужен для быстрой.
  session_id='a1b2c3d4'    # Optional
)
```

## Docker
Для запуска через Docker:

1. Соберите образ:
   ```bash
   docker-compose build
   ```
2. Запустите контейнер:
   ```bash
   docker-compose run --rm mtslinkdownloader [URL] [--session-id SESSION_ID]
   ```
#### Пример с аргументами   
   ```bash
   docker-compose run --rm mtslinkdownloader https://my.mts-link.ru/12345678/987654321/record-new/123456789/record-file/1234567890 --session-id a1b2c3d4
   ```
